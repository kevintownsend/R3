TODO: enable preprocessor to detect and fix matrices that are not prefectly setup
